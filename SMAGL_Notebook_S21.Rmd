---
title: "SMAGL Notebook - Spring 2021"
author: "Nick Mikulski"
date: "2/9/2021"
output:
  html_document:
    toc: true
    toc_depth: 3
    theme: yeti
    toc_float:
      collapsed: false
      smooth_scroll: false
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Introduction
This document will serve as my lab notebook for SMAGL research under Prof. Christopher Schmitt during the Spring 2021 semester. My research for credit application was approved on Feb. 5, 2021.
  
[Application](https://docs.google.com/document/d/1ODJpSP9Owl21iwok2X3M-f-7nAIKtkkMasPKDSp8i4g/edit?usp=sharing)


## Goals for the semester
Given that my main academic interests are in conservation biology, I look forward to being able to work with Laura Angley and assist with her research on the release of rehabilitated vervet monkey populations.  
  
- Learn how to conduct a social network analysis in R  
- Using the rehabilitated vervet monkey dataset, analyze the social networks of the pre-release and post-release populations
- Compare pre-release and post-release networks to look for patterns such as rank and centrality and to identify possible vulnerabilities in the network

## Learning to use SNA R Packages
```{r}


```

### Working Through Stanford SNA Reference
source("http://sna.stanford.edu/setup.R")

install.packages("igraph")

library(igraph)

advice_data_frame <- read.table('http://sna.stanford.edu/sna_R_labs/data/Krack-High-Tec-edgelist-Advice.txt')
friendship_data_frame <- read.table('http://sna.stanford.edu/sna_R_labs/data/Krack-High-Tec-edgelist-Friendship.txt')
reports_to_data_frame <- read.table('http://sna.stanford.edu/sna_R_labs/data/Krack-High-Tec-edgelist-ReportsTo.txt')

head(advice_data_frame)
fix(advice_data_frame)

attributes <- read.csv('http://sna.stanford.edu/sna_R_labs/data/Krack-High-Tec-Attributes.csv', header=T)
attributes

colnames(advice_data_frame) <- c('ego', 'alter', 'advice_tie')
head(advice_data_frame)
  
colnames(friendship_data_frame) <- c('ego', 'alter', 'friendship_tie')
head(friendship_data_frame)
  
colnames(reports_to_data_frame) <- c('ego', 'alter', 'reports_to_tie')
head(reports_to_data_frame)

fix(advice_data_frame)
fix(friendship_data_frame)
fix(reports_to_data_frame)

advice_data_frame$ego == friendship_data_frame$ego   
#This confirms that our columns and rows align before combining the data set
which(advice_data_frame$ego != friendship_data_frame$ego)
which(advice_data_frame$alter != friendship_data_frame$alter)
which(reports_to_data_frame$alter != friendship_data_frame$alter)
which(reports_to_data_frame$ego != friendship_data_frame$ego)

#Combining them into one data frame:
krack_full_data_frame <- cbind(advice_data_frame, 
    friendship_data_frame$friendship_tie, 
    reports_to_data_frame$reports_to_tie)
head(krack_full_data_frame)

#Rename to organize better:
names(krack_full_data_frame)[4:5] <- c("friendship_tie", 
    "reports_to_tie")  
head(krack_full_data_frame)

krack_full_nonzero_edges <- subset(krack_full_data_frame, 
    (advice_tie > 0 | friendship_tie > 0 | reports_to_tie > 0))
head(krack_full_nonzero_edges)

#To Graph:
krack_full <- graph.data.frame(krack_full_nonzero_edges) 
summary(krack_full)
krack_full

get.edge.attribute(krack_full, 'advice_tie')
get.edge.attribute(krack_full, 'friendship_tie')
get.edge.attribute(krack_full, 'reports_to_tie')

krack_full_symmetrized <- as.undirected(krack_full, mode='collapse')
summary(krack_full_symmetrized)

attributes = cbind(1:length(attributes[,1]), attributes)
krack_full <- graph.data.frame(d = krack_full_nonzero_edges, 
                               vertices = attributes)

summary(krack_full)

get.vertex.attribute(krack_full, 'AGE')
get.vertex.attribute(krack_full, 'TENURE')
get.vertex.attribute(krack_full, 'LEVEL')
get.vertex.attribute(krack_full, 'DEPT')

#Saves plotted graph as a pdf:
setwd("/users/nickmikulski/Desktop/SMAGL/Spring2021")
pdf("1.1_Krackhardt_Full.pdf")
plot(krack_full)
dev.off()

krack_advice_only <- delete.edges(krack_full, 
    E(krack_full)[get.edge.attribute(krack_full,
    name = "advice_tie") == 0])
summary(krack_advice_only)
pdf("1.2_Krackhardt_Advice.pdf")
plot(krack_advice_only)
dev.off()

krack_friendship_only <- delete.edges(krack_full, 
    E(krack_full)[get.edge.attribute(krack_full, 
    name = "friendship_tie") == 0])
summary(krack_friendship_only)
pdf("1.3_Krackhardt_Friendship.pdf")
plot(krack_friendship_only)
dev.off()

krack_reports_to_only <- delete.edges(krack_full, 
    E(krack_full)[get.edge.attribute(krack_full, 
    name = "reports_to_tie") == 0])
summary(krack_reports_to_only)
pdf("1.4_Krackhardt_Reports.pdf")
plot(krack_reports_to_only)
dev.off()

reports_to_layout <- layout.fruchterman.reingold(krack_reports_to_only)
pdf("1.5_Krackhardt_Reports_Fruchterman_Reingold.pdf")
plot(krack_reports_to_only, 
     layout=reports_to_layout)
dev.off()

dept_vertex_colors = get.vertex.attribute(krack_full,"DEPT")
colors = c('Black', 'Red', 'Blue', 'Yellow', 'Green')
dept_vertex_colors[dept_vertex_colors == 0] = colors[1]
dept_vertex_colors[dept_vertex_colors == 1] = colors[2]
dept_vertex_colors[dept_vertex_colors == 2] = colors[3]
dept_vertex_colors[dept_vertex_colors == 3] = colors[4] 
dept_vertex_colors[dept_vertex_colors == 4] = colors[5]
 
pdf("1.6_Krackhardt_Reports_Color.pdf") 
plot(krack_reports_to_only, 
    layout=reports_to_layout, 
    vertex.color=dept_vertex_colors, 
    vertex.label=NA, 
    edge.arrow.size=.5)
dev.off() 

tenure_vertex_sizes = get.vertex.attribute(krack_full,"TENURE")
 
pdf("1.7_Krackhardt_Reports_Vertex_Size.pdf") 
plot(krack_reports_to_only, 
     layout=reports_to_layout, 
     vertex.color=dept_vertex_colors, 
     vertex.label=NA, 
     edge.arrow.size=.5,
     vertex.size=tenure_vertex_sizes)
dev.off() 

# Citations

## R Coding References

- [Barbera P. (2017) Introduction to social network analysis with R.](http://pablobarbera.com/big-data-upf/html/02a-networks-intro-visualization.html)  
- [McFarland DA, Messing S, Nowak M, Westwood SJ. (2010) Network Analysis Labs in R and SoNIA.](https://sna.stanford.edu/rlabs.php)  
- [Sadler J. (2017) Introduction to Network Analysis with R.](https://www.jessesadler.com/post/network-analysis-with-r/)  
- [Zhang G. (2010) Social network analysis with R sna package.](https://www.r-project.org/nosvn/conferences/useR-2010/slides/Zhang.pdf)  


## Social Network Analysis Literature

- Brent LJN, Lehmann J, Ramos-FernÃ¡ndez G. (2011) Social network analysis in the study of nonhuman primates: A historical perspective. *American Journal of Primatology*, **73**, 720-730.  
- Guy AJ, Stone OML, Curnoe D. (2012) The release of a troop of rehabilitated vervet monkeys (Chlorocebus aethiops) in KwaZulu-Natal, South Africa: Outcomes and Assessment. *Folia Primatologica*, **82**, 308-320.  
- McCowan B, Anderson K, Heagarty A, Cameron A. (2008) Utility of social network analysis for primate behavioral management and well-being. *Applied Animal Behaviour Science*, **109**, 396-405.  
- Puga-Gonzalez I, Sosa S, Sueur C. (2019) Editorial: Social networks analyses in primates, a multilevel perspective. *Primates*, **60**, 163-165.  
- Sueur C, Jacobs A, Amblard F, Petit O, King AJ. (2011) How can social network analysis improve the study of primate behavior? *American Journal of Primatology*, **73**, 703-719.  